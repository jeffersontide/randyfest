<!DOCTYPE html>
<html>
<head>
  <link rel="shortcut icon" type="image/x-icon" href="favicon.ico"/>
  <BODY bgcolor="ddffdd" TEXT="#000000" vLINK="#000000" LINK="#000099">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8;width=device-width">
  <style>
    body {
      font-family: "Arial", sans-serif;
    }
    
    .sidenav {
      height: 100%;
      width: 127px;
      position: fixed;
      background-image:url('./b.jpg');
      z-index: 1;
      top: 0;
      left: 0;
      background-color: #111;
      overflow-x: hidden;
      padding-top: 65px;
    }
    
    .sidenav a {
      padding: 12px 8px 48px 26px;
      text-decoration: none;
      font-size: 20px;
      color: #000000;
      display: block;
      transform: rotate(-28deg);
    }
    
    .sidenav a:hover {
      color: #f1f1f1;
      font-style:italic;
    }
    
    .main {
      margin-left: 160px; /* Same as the width of the sidenav */
      font-size: 15px; /* Increased text to enable scrolling */
      padding: 0px 0px;
    }
    
    @media screen and (max-height: 450px) {
      .sidenav {padding-top: 15px;}
      .sidenav a {font-size: 15px;}
    }
  </style>
</head>
<body>
  <div class="sidenav">
    <center>
      <a href="./index.html">Home</a>
      <a href="./registration.html">Registration</a>
      <a href="mailto:lniu@sas.upenn.edu">Contact</a>
      <br><br><br><br>
      <a href="https://www.physics.upenn.edu/~kamien/kamiengroup/">Kamien Group</a>
    </center>
  </div>
  
  <div class="main">
    <title>Geometers of Soft Materials Symposium</title>
    
    <h1><center>Geometers of Soft Materials Symposium</center></h1>
    <h2><center>in honor of Randall D. Kamien's 60th birthday</center></h2>
    
    <br><br>
    
    <p>
      <h2>Guestbook</h2>

      <form id="guestbookForm">
        <input type="text" id="name" placeholder="Your Name" required>
        <br />
        <input type="text" id="email" placeholder="Email (will not be displayed)" required>
        <br />
        <textarea id="message" rows="4" placeholder="Write a message..." required></textarea>
        <br />
        <input type="text" id="extra" style="display:none" tabindex="-1" autocomplete="off">
        <button type="submit" id="submitButton">Post Message</button>
        <div id="status"></div>
      </form>
  
      <hr>
  
      <h3>Messages</h3>
      <div id="entries">Loading messages...</div>
  
      <script>
          const scriptURL = 'https://script.google.com/macros/s/AKfycbxoDWeGEmeZLWvjlgCejG0Fh023PRybILI3m3T8wjvo9DPN1__oE2hRTMTPkSoEiArP/exec';
          const csvURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRmZ-lABDTYPTYKM952pg7UF5YgA9ZvYSaF1Yxxfl5UI75Wg0T4P6IPm1YFt0J5QxZFjz06WhtSVjlR/pub?gid=0&single=true&output=csv';
  
          const form = document.getElementById('guestbookForm');
          const status = document.getElementById('status');
          const submitButton = document.getElementById('submitButton');
  
          form.addEventListener('submit', e => {
              e.preventDefault();
              submitButton.disabled = true;
              status.innerText = "Sending...";
  
              const data = {
                  name: document.getElementById('name').value,
                  message: document.getElementById('message').value,
                  email: document.getElementById('email').value
              };
  
              fetch(scriptURL, {
                  method: 'POST',
                  mode: 'no-cors',
                  cache: 'no-cache',
                  body: JSON.stringify(data)
              })
              .then(() => {
                  status.innerText = "Message sent successfully!";
                  form.reset();
                  submitButton.disabled = false;
                  setTimeout(loadEntries, 2000); // Reload list after 2 seconds
              })
              .catch(error => {
                  console.error('Error!', error.message);
                  status.innerText = "Error sending message.";
                  submitButton.disabled = false;
              });
          });
  
          async function loadEntries() {
              try {
                  const response = await fetch(csvURL);
                  const data = await response.text();
                  
                  const rows = data.split(/\r?\n/).slice(1); 
                  const container = document.getElementById('entries');
                  container.innerHTML = '';

                  // show newest messages first
                  rows.reverse().forEach(row => {
                      const cols = row.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);

                      if (cols && cols.length >= 5) {
                          const status = cols[4].replace(/^"|"$/g, '').trim();
                      
                          if (status === "Approved") {
                              const date = cols[0].replace(/^"|"$/g, '');
                              const name = cols[1].replace(/^"|"$/g, '');
                              // skip col[2] (email) for privacy
                              const msg = cols[3].replace(/^"|"$/g, '');
                      
                              const div = document.createElement('div');
                              div.className = 'entry';
                              div.innerHTML = `
                                  <strong>${name}</strong>: ${msg}<br>
                                  <span class="entry-date">${date}</span>
                              `;
                              container.appendChild(div);
                          }
                      }
                  });
                  
                  if (container.innerHTML === '') {
                      container.innerText = "No messages yet.";
                  }
          
              } catch (err) {
                  document.getElementById('entries').innerText = "Could not load messages.";
              }
          }
  
          // Initial load
          loadEntries();
      </script>
      
    </p>
    
    <hr size=2>
      
    <em>
      This event is sponsored by the <a href="https://www.physics.upenn.edu/">University of Pennsylvania Department of Physics and Astronomy</a> and the <a href="https://www.lrsm.upenn.edu/research/">Materials Research Science &amp; Engineering Center at the University of Pennsylvania</a>.
    </em>
    
    <hr size=2>
    
    <em>Made with lovingly handcrafted HTML.</em>
    
  </div>
</body>
</html>
