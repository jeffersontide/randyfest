<!DOCTYPE html>
<html>
<head>
  <link rel="shortcut icon" type="image/x-icon" href="favicon.ico"/>
  <BODY bgcolor="ddffdd" TEXT="#000000" vLINK="#000000" LINK="#000099">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8;width=device-width">
  <style>
    body {
      font-family: "Arial", sans-serif;
    }
    
    .sidenav {
      height: 100%;
      width: 127px;
      position: fixed;
      background-image:url('./b.jpg');
      z-index: 1;
      top: 0;
      left: 0;
      background-color: #111;
      overflow-x: hidden;
      padding-top: 60px;
    }
    
    .sidenav a {
      padding-top: 12px;
      padding-left: 20px;
      padding-right: 30px;
      padding-bottom: 22px;
      text-decoration: none;
      font-size: 19px;
      color: #000000;
      display: block;
      transform: rotate(-28deg);
    }
    
    .sidenav a:hover {
      color: #f1f1f1;
      font-style:italic;
    }
    
    .main {
      margin-left: 160px; /* Same as the width of the sidenav */
      font-size: 15px; /* Increased text to enable scrolling */
      padding: 0px 0px;
    }
    
    @media screen and (max-height: 450px) {
      .sidenav {padding-top: 15px;}
      .sidenav a {font-size: 15px;}
    }
  </style>
</head>
<body>
  <div class="sidenav">
    <center>
      <a href="./index.html">Randyfest guestbook</a>
      <a href="https://www.physics.upenn.edu/events/geometers-soft-materials-symposium">symposium website</a>
      <a href="mailto:lniu@sas.upenn.edu">email organizers</a>
      <br><br><br><br><br>
      <a href="https://www.physics.upenn.edu/~kamien/kamiengroup/">Kamien Group</a>
    </center>
  </div>
  
  <div class="main">
    <title>Geometers of Soft Materials Symposium (aka Randyfest 2026)</title>
    
    <h1><center>Geometers of Soft Materials Symposium</center></h1>
    <h2><center>in honor of Randall D. Kamien's 60th birthday</center></h2>
    
    <center>
      <a onmouseover="MouseOver(nv_link)" onmouseout="MouseOut(nv_link)">
        <img src="./young2.jpg" name="nv_link" height=400 align=center onmouseover="this.src='./still_young2.jpg'" onmouseout="this.src='./young2.jpg'">
      <br clear=all>
    </center>
    
    <br><br>
    
    <p>
      <h2>Randyfest 2026 Guestbook</h2>

      <form id="guestbookForm">
        <input type="text" id="name" placeholder="Your Name" required style="font-size: 1.0rem;">
        <br />
        <input type="text" id="email" placeholder="Email (will not be displayed)" required style="font-size: 1.0rem;">
        <br />
        <textarea id="message" rows="4" placeholder="Write a message..." required style="width: 80%; max-width: 600px; font-size: 1.0rem;"></textarea>
        <br />
        <input type="text" id="extra" style="display:none" tabindex="-1" autocomplete="off">
        <button type="submit" id="submitButton" style="padding: 5px 5px; font-size: 1.0rem;">Post Message</button>
        <div id="status"></div>
      </form>
  
      <hr>
  
      <h3>Messages</h3>

      <i>Note: Messages may take a while to show up, and may also be moderated arbitrarily by Lauren.</i>
      <br/><br/>
      
      <div id="entries">Loading messages...</div>
  
      <script>
          const scriptURL = 'https://script.google.com/macros/s/AKfycbw2QXyYq3immxR--Z_QHTgczCTIgJtciI2BQZHAMrg0zxXxyaaXDcp6uUjTz-vko9c-Ww/exec';
          const csvURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRmZ-lABDTYPTYKM952pg7UF5YgA9ZvYSaF1Yxxfl5UI75Wg0T4P6IPm1YFt0J5QxZFjz06WhtSVjlR/pub?gid=0&single=true&output=csv';
  
          const form = document.getElementById('guestbookForm');
          const status = document.getElementById('status');
          const submitButton = document.getElementById('submitButton');
  
          form.addEventListener('submit', e => {
              e.preventDefault();
              submitButton.disabled = true;
              status.innerText = "Sending...";
  
              const data = {
                  name: document.getElementById('name').value,
                  message: document.getElementById('message').value,
                  email: document.getElementById('email').value,
                  extra: document.getElementById('extra').value
              };
  
              fetch(scriptURL, {
                  method: 'POST',
                  mode: 'no-cors',
                  cache: 'no-cache',
                  body: JSON.stringify(data)
              })
              .then(() => {
                  status.innerText = "Message sent successfully!";
                  form.reset();
                  submitButton.disabled = false;
                  setTimeout(loadEntries, 2000); // Reload list after 2 seconds
              })
              .catch(error => {
                  console.error('Error!', error.message);
                  status.innerText = "Error sending message.";
                  submitButton.disabled = false;
              });
          });
  
          async function loadEntries() {
              try {
                  const finalURL = csvURL.includes('?') 
                      ? `${csvURL}&t=${Date.now()}` 
                      : `${csvURL}?t=${Date.now()}`;
          
                  const response = await fetch(finalURL);
                  
                  if (!response.ok) throw new Error('Network response was not ok');
                  
                  const csvText = await response.text();
                  const container = document.getElementById('entries');
                  
                  const rows = csvText.split(/\r?\n/).filter(row => row.trim() !== "");
                  container.innerHTML = '';
          
                  const dataRows = rows.slice(1).reverse();
          
                  dataRows.forEach(row => {
                      const cols = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                      
                      if (cols && cols.length >= 4) {
                          const dateRaw = cols[0].replace(/^"|"$/g, '').trim();
                          const name = cols[1].replace(/^"|"$/g, '').trim();
                          const msg = cols[3].replace(/^"|"$/g, '').trim();
                          const approved = (cols[4] || "").replace(/^"|"$/g, '').trim();
                  
                          const parsedDate = new Date(dateRaw);
                          
                          if (name !== "" && !isNaN(parsedDate) && approved.toLowerCase() === "approved") {
                              const div = document.createElement('div');
                              div.className = 'entry';
                              
                              const dateDisplay = parsedDate.toLocaleDateString(undefined, { 
                                  year: 'numeric', 
                                  month: 'short', 
                                  day: 'numeric' 
                              });
                  
                              div.innerHTML = `
                                  <strong>${name}</strong>: ${msg}<br/>
                                  <span class="entry-date">${dateDisplay}</span>
                                  <br/><br/>
                              `;
                              container.appendChild(div);
                          }
                      }
                  });
          
                  if (container.innerHTML === '') {
                      container.innerHTML = "<em>No approved messages yet.</em>";
                  }
          
              } catch (err) {
                  console.error("Display Error:", err);
                  document.getElementById('entries').innerHTML = "Error loading entries.";
              }
          }
  
          // Initial load
          loadEntries();
      </script>
      
    </p>
      
    <hr size=2>
      
    <em>
      This event is sponsored by the <a href="https://www.physics.upenn.edu/">University of Pennsylvania Department of Physics and Astronomy</a> and the <a href="https://www.lrsm.upenn.edu/research/">Materials Research Science &amp; Engineering Center at the University of Pennsylvania</a>.
    </em>
    
    <hr size=2>
    
    <em>Made with lovingly handcrafted HTML.</em>
    
  </div>
</body>
</html>
